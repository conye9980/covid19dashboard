<html>
  <head>
    <title>Graphing the daily Irish COVID swab tests results against positivity rates</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-trendline"></script>
	<style>
      fieldset {
        border-radius: 15px;
      }
      
      legend {
        padding: 2px 4px;
      }

      select {
        text-align-last: right;
      }

      option {
        direction: rtl;
      }

      table {
        border-collapse: collapse;
        width: 100%;
      }

      th, td {
        padding: 8px 16px;
        border: 1px solid #ccc;
      }

      th {
        background: #eee;
      }

      td:not(:nth-child(1)) {
        text-align: center;
      }

      button {
        width: 100%;
        margin: 5px;
      }
    </style>
  </head>
  <body>
    <div style="height: 85%;">
      <div style="width: 20%; height: 100%; display: inline-block; text-align: center;">
        <div style="width: 80%; padding: 15px; text-align: left;">
          <fieldset>
            <legend>Data selection</legend>
            <div>
              <input type="radio" name="data" onclick="allData()"> All dates
            </div>
            <div>
              <input type="radio" name="data" checked onclick="lastTwoMonths()"> Last two months
            </div>
            <div>
              <input type="radio" name="data" onclick="twoMonthView()"> Two month view
       		  <select name="twoMonthView" id="twoMonthView" onchange="twoMonthView()" style="width: 100%;" disabled></select>
            </div>
            <div>
              <div>
                <input type="radio" name="data" onclick="betweenDates()"> Between dates
              </div>
              <div style="float: right;">
                <div style="text-align: right;">
                  <div id="startDateLabel" style="color: #999999; float: right;">Start date </span>
                  <div style="float: right; padding-left: 5px;">
                  	<select name="startDate" id="startDate" onchange="betweenDates();"></select>
                  </div>
                </div>
                <div style="text-align: right;">
                  <div id="endDateLabel" style="color: #999999; float: right;">End date </span>
                  <div style="float: right; padding-left: 5px;">
                  	<select name="endDate" id="endDate" onchange="betweenDates()"></select>
                  </div>
                </div>
              </div>
            </div>
          </fieldset>
          <fieldset>
            <legend>Graph type</legend>
            <div>
              <input type="radio" name="graphType" id="graphType" value="0" onclick="standardGraph()" checked> Normal
            </div>
            <div>
              <input type="radio" name="graphType" id="graphType" value="1" onclick="dayAverage(1)"> Rolling seven day average
            </div>
            <div>
              <input type="radio" name="graphType" id="graphType" value="2" onclick="dayAverage(7, 'Seven days to ')"> Seven day average
            </div>
            <div>
              <input type="radio" name="graphType" id="graphType" value="3" onclick="byDay()"> By weekday
              <select name="day" id="day" disabled="true" onchange="byDay()" style="float: right;">
                <option value="0">Sunday</option>
                <option value="1">Monday</option>
                <option value="2">Tuesday</option>
                <option value="3">Wednesday</option>
                <option value="4">Thursday</option>
                <option value="5">Friday</option>
                <option value="6">Saturday</option>
              </select>
            </div>
            <div>
              <input type="radio" name="graphType" id="graphType" value="4" onclick="weeklyTotal()"> Weekly total
            </div>
        </fieldset>
        <fieldset>
          <legend>Display as</legend>
          <div>
            <input type="radio" name="displayType" id="displayType" value="0" onclick="displayGraph()" checked> Graph
          </div>
          <div style="text-align: center;">
          	<input type="checkbox" id="trendLine" name="trendLine" value="trendLine" onclick="trendLine()" checked> Trend line
          </div>
          <div>
            <input type="radio" name="displayType" id="displayType" value="1" onclick="displayTable()"> Table
          </div>
        </fieldset>
        <fieldset>
          <legend>Export data</legend>
          <div>
            <button type="button" id="exportImage" value="exportImage" onclick="exportAsImage()">Export as image</button>
          </div>
          <div>
            <button type="button" id="exportCSV" value="exportCSV" onclick="exportAsCSV()">Export as CSV</button>
          </div>
        </fieldset>
        <fieldset>
          <legend>Links</legend>
          <div>
          	<a href="https://github.com/tetsujin1979/testsVpositivity">Github Source</a>
          </div>
          <div>
          	<a href="https://www.chartjs.org/">Chart.js Library</a>
          </div>
          <div>
          	<a href="https://github.com/Makanz/chartjs-plugin-trendline">Trendline plugin</a>
          </div>
          <div>
          	<a href="https://github.com/ShaneHastings/Twitter-AutoPost-for-COVID-Data">COVID-19 Data Ireland</a>
          </div>
        </fieldset>
      </div>
    </div>
      <div style="width: 75%; float: right; border: 1px #555555 solid; border-radius: 15px; margin: 1px auto; padding: 15px;">
        <div id="table" style="display: none; height: 95%; margin: 1px auto; padding: 15px; text-align: left; overflow-y: scroll;">
          <table id="dataTable">
            <thead>
              <tr>
                <th rowspan="2">Date</th>
                <th colspan="4">Daily Tests</th>
                <th colspan="4">Total Tests</th>
                <th colspan="2">Daily change in positive tests</th>
              </tr>
              <tr>
                <th>Total</th>
                <th>Positive</th>
                <th>Negative</th>
                <th>% Positive</th>
                <th>Total</th>
                <th>Positive</th>
                <th>Negative</th>
                <th>% Positive</th>
                <th>Actual</th>
                <th>Percentage</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
        <div id="graph">
          <canvas id="testsVpositivityRate"></canvas>
        </div>
      </div>
    </div>
    <script type="text/javascript">
      var dayOptions = document.getElementById("day").options;
      var today = new Date();
      var csv = [];
      var months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];

      Chart.plugins.register({
        beforeDraw: function(chartInstance) {
          var ctx = chartInstance.chart.ctx;
          ctx.fillStyle = "white";
          ctx.fillRect(0, 0, chartInstance.chart.width, chartInstance.chart.height);
        }
      });

      for (var counter = 0; counter < dayOptions.length; counter++) {
          var option = dayOptions[counter];
          if (option.value == today.getDay()) {
              option.selected = true;
          }
      }
      var ctx = document.getElementById('testsVpositivityRate').getContext('2d');
      var data = [
        {date: new Date('2020-03-19'), positiveSwabs: 70, totalSwabs: 946},
        {date: new Date('2020-03-20'), positiveSwabs: 105, totalSwabs: 1469},
        {date: new Date('2020-03-21'), positiveSwabs: 55, totalSwabs: 1564},
        {date: new Date('2020-03-22'), positiveSwabs: 119, totalSwabs: 978},
        {date: new Date('2020-03-23'), positiveSwabs: 113, totalSwabs: 2581},
        {date: new Date('2020-03-24'), positiveSwabs: 129, totalSwabs: 1566},
        {date: new Date('2020-03-25'), positiveSwabs: 150, totalSwabs: 1775},
        {date: new Date('2020-03-26'), positiveSwabs: 448, totalSwabs: 3376},
        {date: new Date('2020-03-27'), positiveSwabs: 307, totalSwabs: 2941},
        {date: new Date('2020-03-28'), positiveSwabs: 664, totalSwabs: 2206},
        {date: new Date('2020-03-29'), positiveSwabs: 288, totalSwabs: 1616},
        {date: new Date('2020-03-30'), positiveSwabs: 436, totalSwabs: 1397},
        {date: new Date('2020-03-31'), positiveSwabs: 378, totalSwabs: 1928},
        {date: new Date('2020-04-01'), positiveSwabs: 416, totalSwabs: 2009},
        {date: new Date('2020-04-02'), positiveSwabs: 367, totalSwabs: 1975},
        {date: new Date('2020-04-03'), positiveSwabs: 470, totalSwabs: 1857},
        {date: new Date('2020-04-04'), positiveSwabs: 460, totalSwabs: 1849},
        {date: new Date('2020-04-05'), positiveSwabs: 318, totalSwabs: 2831},
        {date: new Date('2020-04-06'), positiveSwabs: 855, totalSwabs: 6117},
        {date: new Date('2020-04-07'), positiveSwabs: 495, totalSwabs: 1853},
        {date: new Date('2020-04-08'), positiveSwabs: 619, totalSwabs: 3728},
        {date: new Date('2020-04-09'), positiveSwabs: 809, totalSwabs: 5487},
        {date: new Date('2020-04-10'), positiveSwabs: 834, totalSwabs: 6959},
        {date: new Date('2020-04-11'), positiveSwabs: 1219, totalSwabs: 6990},
        {date: new Date('2020-04-12'), positiveSwabs: 917, totalSwabs: 5722},
        {date: new Date('2020-04-13'), positiveSwabs: 1377, totalSwabs: 8427},
        {date: new Date('2020-04-14'), positiveSwabs: 877, totalSwabs: 4275},
        {date: new Date('2020-04-15'), positiveSwabs: 653, totalSwabs: 3036},
        {date: new Date('2020-04-16'), positiveSwabs: 725, totalSwabs: 3644},
        {date: new Date('2020-04-17'), positiveSwabs: 909, totalSwabs: 4355},
        {date: new Date('2020-04-18'), positiveSwabs: 438, totalSwabs: 2209},
        {date: new Date('2020-04-19'), positiveSwabs: 374, totalSwabs: 2313},
        {date: new Date('2020-04-20'), positiveSwabs: 232, totalSwabs: 1626},
        {date: new Date('2020-04-21'), positiveSwabs: 707, totalSwabs: 3757},
        {date: new Date('2020-04-22'), positiveSwabs: 1260, totalSwabs: 5363},
        {date: new Date('2020-04-23'), positiveSwabs: 568, totalSwabs: 4871},
        {date: new Date('2020-04-24'), positiveSwabs: 604, totalSwabs: 5580},
        {date: new Date('2020-04-25'), positiveSwabs: 386, totalSwabs: 5632},
        {date: new Date('2020-04-26'), positiveSwabs: 1093, totalSwabs: 8598},
        {date: new Date('2020-04-27'), positiveSwabs: 357, totalSwabs: 5100},
        {date: new Date('2020-04-28'), positiveSwabs: 367, totalSwabs: 6306},
        {date: new Date('2020-04-29'), positiveSwabs: 420, totalSwabs: 8159},
        {date: new Date('2020-04-30'), positiveSwabs: 300, totalSwabs: 8218},
        {date: new Date('2020-05-01'), positiveSwabs: 262, totalSwabs: 7451},
        {date: new Date('2020-05-02'), positiveSwabs: 447, totalSwabs: 12076},
        {date: new Date('2020-05-03'), positiveSwabs: 324, totalSwabs: 9799},
        {date: new Date('2020-05-04'), positiveSwabs: 327, totalSwabs: 8617},
        {date: new Date('2020-05-05'), positiveSwabs: 204, totalSwabs: 7512},
        {date: new Date('2020-05-06'), positiveSwabs: 279, totalSwabs: 7815},
        {date: new Date('2020-05-07'), positiveSwabs: 201, totalSwabs: 5703},
        {date: new Date('2020-05-08'), positiveSwabs: 163, totalSwabs: 4973},
        {date: new Date('2020-05-09'), positiveSwabs: 197, totalSwabs: 7657},
        {date: new Date('2020-05-10'), positiveSwabs: 325, totalSwabs: 6517},
        {date: new Date('2020-05-11'), positiveSwabs: 165, totalSwabs: 5374},
        {date: new Date('2020-05-12'), positiveSwabs: 136, totalSwabs: 6138},
        {date: new Date('2020-05-13'), positiveSwabs: 211, totalSwabs: 4674},
        {date: new Date('2020-05-14'), positiveSwabs: 219, totalSwabs: 6210},
        {date: new Date('2020-05-15'), positiveSwabs: 108, totalSwabs: 5699},
        {date: new Date('2020-05-16'), positiveSwabs: 112, totalSwabs: 6334},
        {date: new Date('2020-05-17'), positiveSwabs: 126, totalSwabs: 6457},
        {date: new Date('2020-05-18'), positiveSwabs: 81, totalSwabs: 3964},
        {date: new Date('2020-05-19'), positiveSwabs: 59, totalSwabs: 3278},
        {date: new Date('2020-05-20'), positiveSwabs: 94, totalSwabs: 4764},
        {date: new Date('2020-05-21'), positiveSwabs: 126, totalSwabs: 5274},
        {date: new Date('2020-05-22'), positiveSwabs: 112, totalSwabs: 5373},
        {date: new Date('2020-05-23'), positiveSwabs: 78, totalSwabs: 4276},
        {date: new Date('2020-05-24'), positiveSwabs: 57, totalSwabs: 3509},
        {date: new Date('2020-05-25'), positiveSwabs: 98, totalSwabs: 3529},
        {date: new Date('2020-05-26'), positiveSwabs: 67, totalSwabs: 3515},
        {date: new Date('2020-05-27'), positiveSwabs: 67, totalSwabs: 3437},
        {date: new Date('2020-05-28'), positiveSwabs: 44, totalSwabs: 3811},
        {date: new Date('2020-05-29'), positiveSwabs: 72, totalSwabs: 4364},
        {date: new Date('2020-05-30'), positiveSwabs: 70, totalSwabs: 3423},
        {date: new Date('2020-05-31'), positiveSwabs: 70, totalSwabs: 3474},
        {date: new Date('2020-06-01'), positiveSwabs: 42, totalSwabs: 2285},
        {date: new Date('2020-06-02'), positiveSwabs: 24, totalSwabs: 1827},
        {date: new Date('2020-06-03'), positiveSwabs: 40, totalSwabs: 2486},
        {date: new Date('2020-06-04'), positiveSwabs: 33, totalSwabs: 3099},
        {date: new Date('2020-06-05'), positiveSwabs: 36, totalSwabs: 3234},
        {date: new Date('2020-06-06'), positiveSwabs: 27, totalSwabs: 3106},
        {date: new Date('2020-06-07'), positiveSwabs: 21, totalSwabs: 2828},
        {date: new Date('2020-06-08'), positiveSwabs: 9, totalSwabs: 1960},
        {date: new Date('2020-06-09'), positiveSwabs: 19, totalSwabs: 2355},
        {date: new Date('2020-06-10'), positiveSwabs: 19, totalSwabs: 2675},
        {date: new Date('2020-06-11'), positiveSwabs: 29, totalSwabs: 4240},
        {date: new Date('2020-06-12'), positiveSwabs: 44, totalSwabs: 3009},
        {date: new Date('2020-06-13'), positiveSwabs: 16, totalSwabs: 2712},
        {date: new Date('2020-06-14'), positiveSwabs: 13, totalSwabs: 2512},
        {date: new Date('2020-06-15'), positiveSwabs: 21, totalSwabs: 1714},
        {date: new Date('2020-06-16'), positiveSwabs: 5, totalSwabs: 2112},
        {date: new Date('2020-06-17'), positiveSwabs: 22, totalSwabs: 3420},
        {date: new Date('2020-06-18'), positiveSwabs: 13, totalSwabs: 3359},
        {date: new Date('2020-06-19'), positiveSwabs: 29, totalSwabs: 3161},
        {date: new Date('2020-06-20'), positiveSwabs: 14, totalSwabs: 2724},
        {date: new Date('2020-06-21'), positiveSwabs: 9, totalSwabs: 2159},
        {date: new Date('2020-06-22'), positiveSwabs: 6, totalSwabs: 1498},
        {date: new Date('2020-06-23'), positiveSwabs: 6, totalSwabs: 2116},
        {date: new Date('2020-06-24'), positiveSwabs: 22, totalSwabs: 3252},
        {date: new Date('2020-06-25'), positiveSwabs: 12, totalSwabs: 2983},
        {date: new Date('2020-06-26'), positiveSwabs: 37, totalSwabs: 3689},
        {date: new Date('2020-06-27'), positiveSwabs: 4, totalSwabs: 4007},
        {date: new Date('2020-06-28'), positiveSwabs: 4, totalSwabs: 2724},
        {date: new Date('2020-06-29'), positiveSwabs: 28, totalSwabs: 3340},
        {date: new Date('2020-06-30'), positiveSwabs: 7, totalSwabs: 4591},
        {date: new Date('2020-07-01'), positiveSwabs: 22, totalSwabs: 4551},
        {date: new Date('2020-07-02'), positiveSwabs: 8, totalSwabs: 3792},
        {date: new Date('2020-07-03'), positiveSwabs: 10, totalSwabs: 8049},
        {date: new Date('2020-07-04'), positiveSwabs: 29, totalSwabs: 8312},
        {date: new Date('2020-07-05'), positiveSwabs: 8, totalSwabs: 7000},
        {date: new Date('2020-07-06'), positiveSwabs: 20, totalSwabs: 6529},
        {date: new Date('2020-07-07'), positiveSwabs: 11, totalSwabs: 6161},
        {date: new Date('2020-07-08'), positiveSwabs: 20, totalSwabs: 4361},
        {date: new Date('2020-07-09'), positiveSwabs: 27, totalSwabs: 3945},
        {date: new Date('2020-07-10'), positiveSwabs: 21, totalSwabs: 9330},
        {date: new Date('2020-07-11'), positiveSwabs: 41, totalSwabs: 8929},
        {date: new Date('2020-07-12'), positiveSwabs: 14, totalSwabs: 8717},
        {date: new Date('2020-07-13'), positiveSwabs: 19, totalSwabs: 7664},
        {date: new Date('2020-07-14'), positiveSwabs: 15, totalSwabs: 6400},
        {date: new Date('2020-07-15'), positiveSwabs: 17, totalSwabs: 4387},
        {date: new Date('2020-07-16'), positiveSwabs: 24, totalSwabs: 4316},
        {date: new Date('2020-07-17'), positiveSwabs: 26, totalSwabs: 9512},
        {date: new Date('2020-07-18'), positiveSwabs: 14, totalSwabs: 9243},
        {date: new Date('2020-07-19'), positiveSwabs: 13, totalSwabs: 8630},
        {date: new Date('2020-07-20'), positiveSwabs: 31, totalSwabs: 8415},
        {date: new Date('2020-07-21'), positiveSwabs: 13, totalSwabs: 6674},
        {date: new Date('2020-07-22'), positiveSwabs: 18, totalSwabs: 4619},
        {date: new Date('2020-07-23'), positiveSwabs: 12, totalSwabs: 4067},
        {date: new Date('2020-07-24'), positiveSwabs: 16, totalSwabs: 8980},
        {date: new Date('2020-07-25'), positiveSwabs: 31, totalSwabs: 8888},
        {date: new Date('2020-07-26'), positiveSwabs: 24, totalSwabs: 8016},
        {date: new Date('2020-07-27'), positiveSwabs: 30, totalSwabs: 5804},
        {date: new Date('2020-07-28'), positiveSwabs: 16, totalSwabs: 4965},
        {date: new Date('2020-07-29'), positiveSwabs: 46, totalSwabs: 4740},
        {date: new Date('2020-07-30'), positiveSwabs: 56, totalSwabs: 4383},
        {date: new Date('2020-07-31'), positiveSwabs: 29, totalSwabs: 3856},
        {date: new Date('2020-08-01'), positiveSwabs: 53, totalSwabs: 3306},
        {date: new Date('2020-08-02'), positiveSwabs: 54, totalSwabs: 3131},
        {date: new Date('2020-08-03'), positiveSwabs: 76, totalSwabs: 3041},
        {date: new Date('2020-08-04'), positiveSwabs: 6, totalSwabs: 1991},
        {date: new Date('2020-08-05'), positiveSwabs: 52, totalSwabs: 3761},
        {date: new Date('2020-08-06'), positiveSwabs: 73, totalSwabs: 4833},
        {date: new Date('2020-08-07'), positiveSwabs: 94, totalSwabs: 4980},
        {date: new Date('2020-08-08'), positiveSwabs: 137, totalSwabs: 4880},
        {date: new Date('2020-08-09'), positiveSwabs: 55, totalSwabs: 4107},
        {date: new Date('2020-08-10'), positiveSwabs: 60, totalSwabs: 3874},
        {date: new Date('2020-08-11'), positiveSwabs: 53, totalSwabs: 4026},
        {date: new Date('2020-08-12'), positiveSwabs: 80, totalSwabs: 5843},
        {date: new Date('2020-08-13'), positiveSwabs: 63, totalSwabs: 7072},
        {date: new Date('2020-08-14'), positiveSwabs: 138, totalSwabs: 11337},
        {date: new Date('2020-08-15'), positiveSwabs: 122, totalSwabs: 10653},
        {date: new Date('2020-08-16'), positiveSwabs: 89, totalSwabs: 10352},
        {date: new Date('2020-08-17'), positiveSwabs: 170, totalSwabs: 5533},
        {date: new Date('2020-08-18'), positiveSwabs: 31, totalSwabs: 4339},
        {date: new Date('2020-08-19'), positiveSwabs: 90, totalSwabs: 6192},
        {date: new Date('2020-08-20'), positiveSwabs: 142, totalSwabs: 11416},
        {date: new Date('2020-08-21'), positiveSwabs: 94, totalSwabs: 13080},
        {date: new Date('2020-08-22'), positiveSwabs: 157, totalSwabs: 6758},
        {date: new Date('2020-08-23'), positiveSwabs: 123, totalSwabs: 5438},
        {date: new Date('2020-08-24'), positiveSwabs: 92, totalSwabs: 4838},
        {date: new Date('2020-08-25'), positiveSwabs: 101, totalSwabs: 5015},
        {date: new Date('2020-08-26'), positiveSwabs: 105, totalSwabs: 7648},
        {date: new Date('2020-08-27'), positiveSwabs: 129, totalSwabs: 12274},
        {date: new Date('2020-08-28'), positiveSwabs: 107, totalSwabs: 12303},
        {date: new Date('2020-08-29'), positiveSwabs: 113, totalSwabs: 9940},
        {date: new Date('2020-08-30'), positiveSwabs: 49, totalSwabs: 5659},
        {date: new Date('2020-08-31'), positiveSwabs: 159, totalSwabs: 9340},
        {date: new Date('2020-09-01'), positiveSwabs: 90, totalSwabs: 4892},
        {date: new Date('2020-09-02'), positiveSwabs: 105, totalSwabs: 7301},
        {date: new Date('2020-09-03'), positiveSwabs: 137, totalSwabs: 12501},
        {date: new Date('2020-09-04'), positiveSwabs: 155, totalSwabs: 14064},
        {date: new Date('2020-09-05'), positiveSwabs: 154, totalSwabs: 11322},
        {date: new Date('2020-09-06'), positiveSwabs: 174, totalSwabs: 10343},
        {date: new Date('2020-09-07'), positiveSwabs: 232, totalSwabs: 6253},
        {date: new Date('2020-09-08'), positiveSwabs: 119, totalSwabs: 6678},
        {date: new Date('2020-09-09'), positiveSwabs: 156, totalSwabs: 10749},
        {date: new Date('2020-09-10'), positiveSwabs: 122, totalSwabs: 12363},
        {date: new Date('2020-09-11'), positiveSwabs: 227, totalSwabs: 13073},
        {date: new Date('2020-09-12'), positiveSwabs: 248, totalSwabs: 12230},
        {date: new Date('2020-09-13'), positiveSwabs: 217, totalSwabs: 9815},
        {date: new Date('2020-09-14'), positiveSwabs: 261, totalSwabs: 9888},
        {date: new Date('2020-09-15'), positiveSwabs: 311, totalSwabs: 8120},
        {date: new Date('2020-09-16'), positiveSwabs: 271, totalSwabs: 12241},
        {date: new Date('2020-09-17'), positiveSwabs: 248, totalSwabs: 14663},
        {date: new Date('2020-09-18'), positiveSwabs: 288, totalSwabs: 14506},
        {date: new Date('2020-09-19'), positiveSwabs: 197, totalSwabs: 14380},
        {date: new Date('2020-09-20'), positiveSwabs: 392, totalSwabs: 12138},
        {date: new Date('2020-09-21'), positiveSwabs: 254, totalSwabs: 10031},
        {date: new Date('2020-09-22'), positiveSwabs: 299, totalSwabs: 12583},
        {date: new Date('2020-09-23'), positiveSwabs: 316, totalSwabs: 12671},
        {date: new Date('2020-09-24'), positiveSwabs: 383, totalSwabs: 14356},
        {date: new Date('2020-09-25'), positiveSwabs: 430, totalSwabs: 14538},
        {date: new Date('2020-09-26'), positiveSwabs: 402, totalSwabs: 11808},
        {date: new Date('2020-09-27'), positiveSwabs: 382, totalSwabs: 11878},
        {date: new Date('2020-09-28'), positiveSwabs: 289, totalSwabs: 9866},
        {date: new Date('2020-09-29'), positiveSwabs: 279, totalSwabs: 12673},
        {date: new Date('2020-09-30'), positiveSwabs: 440, totalSwabs: 13247},
        {date: new Date('2020-10-01'), positiveSwabs: 511, totalSwabs: 14524},
        {date: new Date('2020-10-02'), positiveSwabs: 458, totalSwabs: 12673},
        {date: new Date('2020-10-03'), positiveSwabs: 610, totalSwabs: 13621},
        {date: new Date('2020-10-04'), positiveSwabs: 425, totalSwabs: 11295},
        {date: new Date('2020-10-05'), positiveSwabs: 503, totalSwabs: 12166},
        {date: new Date('2020-10-06'), positiveSwabs: 516, totalSwabs: 11646},
        {date: new Date('2020-10-07'), positiveSwabs: 625, totalSwabs: 14542},
        {date: new Date('2020-10-08'), positiveSwabs: 753, totalSwabs: 15880},
        {date: new Date('2020-10-09'), positiveSwabs: 857, totalSwabs: 16522},
        {date: new Date('2020-10-10'), positiveSwabs: 947, totalSwabs: 15634},
        {date: new Date('2020-10-11'), positiveSwabs: 582, totalSwabs: 7998},
        {date: new Date('2020-10-12'), positiveSwabs: 998, totalSwabs: 13988},
        {date: new Date('2020-10-13'), positiveSwabs: 889, totalSwabs: 15305},
        {date: new Date('2020-10-14'), positiveSwabs: 1271, totalSwabs: 16255},
        {date: new Date('2020-10-15'), positiveSwabs: 966, totalSwabs: 13428},
        {date: new Date('2020-10-16'), positiveSwabs: 1376, totalSwabs: 17758},
        {date: new Date('2020-10-17'), positiveSwabs: 1507, totalSwabs: 19040},
        {date: new Date('2020-10-18'), positiveSwabs: 1151, totalSwabs: 16140},
        {date: new Date('2020-10-19'), positiveSwabs: 970, totalSwabs: 14391},
        {date: new Date('2020-10-20'), positiveSwabs: 905, totalSwabs: 14676},
        {date: new Date('2020-10-21'), positiveSwabs: 1112, totalSwabs: 16779},
        {date: new Date('2020-10-22'), positiveSwabs: 1035, totalSwabs: 17834},
        {date: new Date('2020-10-23'), positiveSwabs: 1036, totalSwabs: 17712},
        {date: new Date('2020-10-24'), positiveSwabs: 975, totalSwabs: 17906},
        {date: new Date('2020-10-25'), positiveSwabs: 922, totalSwabs: 15772},
        {date: new Date('2020-10-26'), positiveSwabs: 738, totalSwabs: 14264},
        {date: new Date('2020-10-27'), positiveSwabs: 535, totalSwabs: 11435},
        {date: new Date('2020-10-28'), positiveSwabs: 657, totalSwabs: 11170},
        {date: new Date('2020-10-29'), positiveSwabs: 783, totalSwabs: 15316},
        {date: new Date('2020-10-30'), positiveSwabs: 684, totalSwabs: 13801},
        {date: new Date('2020-10-31'), positiveSwabs: 674, totalSwabs: 14296},
        {date: new Date('2020-11-01'), positiveSwabs: 539, totalSwabs: 11068},
        {date: new Date('2020-11-02'), positiveSwabs: 394, totalSwabs: 11074},
        {date: new Date('2020-11-03'), positiveSwabs: 391, totalSwabs: 10500},
        {date: new Date('2020-11-04'), positiveSwabs: 617, totalSwabs: 12592},
        {date: new Date('2020-11-05'), positiveSwabs: 450, totalSwabs: 11846},
        {date: new Date('2020-11-06'), positiveSwabs: 502, totalSwabs: 11815},
        {date: new Date('2020-11-07'), positiveSwabs: 428, totalSwabs: 12172},
        {date: new Date('2020-11-08'), positiveSwabs: 447, totalSwabs: 9576},
        {date: new Date('2020-11-09'), positiveSwabs: 327, totalSwabs: 9912},
        {date: new Date('2020-11-10'), positiveSwabs: 284, totalSwabs: 10407},
        {date: new Date('2020-11-11'), positiveSwabs: 418, totalSwabs: 10790},
        {date: new Date('2020-11-12'), positiveSwabs: 423, totalSwabs: 13058},
        {date: new Date('2020-11-13'), positiveSwabs: 523, totalSwabs: 11612},
        {date: new Date('2020-11-14'), positiveSwabs: 388, totalSwabs: 9801},
        {date: new Date('2020-11-15'), positiveSwabs: 374, totalSwabs: 9184},
        {date: new Date('2020-11-16'), positiveSwabs: 491, totalSwabs: 11106},
        {date: new Date('2020-11-17'), positiveSwabs: 364, totalSwabs: 9977},
        {date: new Date('2020-11-18'), positiveSwabs: 389, totalSwabs: 12562},
        {date: new Date('2020-11-19'), positiveSwabs: 332, totalSwabs: 12640},
        {date: new Date('2020-11-20'), positiveSwabs: 388, totalSwabs: 12829},
        {date: new Date('2020-11-21'), positiveSwabs: 246, totalSwabs: 10444},
        {date: new Date('2020-11-22'), positiveSwabs: 301, totalSwabs: 9563},
        {date: new Date('2020-11-23'), positiveSwabs: 293, totalSwabs: 9834},
        {date: new Date('2020-11-24'), positiveSwabs: 190, totalSwabs: 10089},
        {date: new Date('2020-11-25'), positiveSwabs: 363, totalSwabs: 12442},
        {date: new Date('2020-11-26'), positiveSwabs: 270, totalSwabs: 12456},
        {date: new Date('2020-11-27'), positiveSwabs: 318, totalSwabs: 10778},
        {date: new Date('2020-11-28'), positiveSwabs: 355, totalSwabs: 11339},
        {date: new Date('2020-11-29'), positiveSwabs: 338, totalSwabs: 9443},
        {date: new Date('2020-11-30'), positiveSwabs: 190, totalSwabs: 9057},
        {date: new Date('2020-12-01'), positiveSwabs: 199, totalSwabs: 9786},
        {date: new Date('2020-12-02'), positiveSwabs: 334, totalSwabs: 11934},
        {date: new Date('2020-12-03'), positiveSwabs: 253, totalSwabs: 12047},
        {date: new Date('2020-12-04'), positiveSwabs: 277, totalSwabs: 11856},
        {date: new Date('2020-12-05'), positiveSwabs: 322, totalSwabs: 11456},
        {date: new Date('2020-12-06'), positiveSwabs: 292, totalSwabs: 9413},
        {date: new Date('2020-12-07'), positiveSwabs: 234, totalSwabs: 9623},
        {date: new Date('2020-12-08'), positiveSwabs: 224, totalSwabs: 10424},
        {date: new Date('2020-12-09'), positiveSwabs: 274, totalSwabs: 12203},
        {date: new Date('2020-12-10'), positiveSwabs: 284, totalSwabs: 12688},
        {date: new Date('2020-12-11'), positiveSwabs: 325, totalSwabs: 12618},
        {date: new Date('2020-12-12'), positiveSwabs: 336, totalSwabs: 12850},
        {date: new Date('2020-12-13'), positiveSwabs: 355, totalSwabs: 10728},
        {date: new Date('2020-12-14'), positiveSwabs: 292, totalSwabs: 10251},
        {date: new Date('2020-12-15'), positiveSwabs: 356, totalSwabs: 10847},
        {date: new Date('2020-12-16'), positiveSwabs: 474, totalSwabs: 13120},
        {date: new Date('2020-12-17'), positiveSwabs: 521, totalSwabs: 13219},
        {date: new Date('2020-12-18'), positiveSwabs: 637, totalSwabs: 14093},
        {date: new Date('2020-12-19'), positiveSwabs: 703, totalSwabs: 13941},
        {date: new Date('2020-12-20'), positiveSwabs: 746, totalSwabs: 13458},
        {date: new Date('2020-12-21'), positiveSwabs: 757, totalSwabs: 12804},
        {date: new Date('2020-12-22'), positiveSwabs: 698, totalSwabs: 13225},
        {date: new Date('2020-12-23'), positiveSwabs: 1077, totalSwabs: 20662},
        {date: new Date('2020-12-24'), positiveSwabs: 1269, totalSwabs: 22876},
        {date: new Date('2020-12-25'), positiveSwabs: 1644, totalSwabs: 21423},
        {date: new Date('2020-12-26'), positiveSwabs: 1207, totalSwabs: 11999},
        {date: new Date('2020-12-27'), positiveSwabs: 343, totalSwabs: 3536},
        {date: new Date('2020-12-28'), positiveSwabs: 1178, totalSwabs: 9405},
        {date: new Date('2020-12-29'), positiveSwabs: 2007, totalSwabs: 13805},
        {date: new Date('2020-12-30'), positiveSwabs: 2867, totalSwabs: 17489},
        {date: new Date('2020-12-31'), positiveSwabs: 4372, totalSwabs: 26312},
        {date: new Date('2021-01-01'), positiveSwabs: 5621, totalSwabs: 27389},
        {date: new Date('2021-01-02'), positiveSwabs: 4554, totalSwabs: 20846},
        {date: new Date('2021-01-03'), positiveSwabs: 6489, totalSwabs: 28543},
        {date: new Date('2021-01-04'), positiveSwabs: 5199, totalSwabs: 20571},
        {date: new Date('2021-01-05'), positiveSwabs: 4416, totalSwabs: 19908},
        {date: new Date('2021-01-06'), positiveSwabs: 6865, totalSwabs: 28370},
        {date: new Date('2021-01-07'), positiveSwabs: 6368, totalSwabs: 28610},
        {date: new Date('2021-01-08'), positiveSwabs: 5156, totalSwabs: 27319},
        {date: new Date('2021-01-09'), positiveSwabs: 5099, totalSwabs: 29972},
        {date: new Date('2021-01-10'), positiveSwabs: 4188, totalSwabs: 24485},
        {date: new Date('2021-01-11'), positiveSwabs: 2922, totalSwabs: 19794},
        {date: new Date('2021-01-12'), positiveSwabs: 2521, totalSwabs: 18945},
        {date: new Date('2021-01-13'), positiveSwabs: 3932, totalSwabs: 24583},
        {date: new Date('2021-01-14'), positiveSwabs: 3854, totalSwabs: 28178},
        {date: new Date('2021-01-15'), positiveSwabs: 3416, totalSwabs: 23033},
        {date: new Date('2021-01-16'), positiveSwabs: 3110, totalSwabs: 26663},
        {date: new Date('2021-01-17'), positiveSwabs: 2868, totalSwabs: 21441},
        {date: new Date('2021-01-18'), positiveSwabs: 1877, totalSwabs: 18191},
        {date: new Date('2021-01-19'), positiveSwabs: 1784, totalSwabs: 19218},
        {date: new Date('2021-01-20'), positiveSwabs: 2786, totalSwabs: 24296},
        {date: new Date('2021-01-21'), positiveSwabs: 2318, totalSwabs: 23196},
        {date: new Date('2021-01-22'), positiveSwabs: 2084, totalSwabs: 24189},
        {date: new Date('2021-01-23'), positiveSwabs: 1926, totalSwabs: 21492},
        {date: new Date('2021-01-24'), positiveSwabs: 1529, totalSwabs: 19593},
        {date: new Date('2021-01-25'), positiveSwabs: 1085, totalSwabs: 14884},
        {date: new Date('2021-01-26'), positiveSwabs: 953, totalSwabs: 16665},
        {date: new Date('2021-01-27'), positiveSwabs: 1668, totalSwabs: 22387},
        {date: new Date('2021-01-28'), positiveSwabs: 1587, totalSwabs: 21780},
        {date: new Date('2021-01-29'), positiveSwabs: 1483, totalSwabs: 21943},
        {date: new Date('2021-01-30'), positiveSwabs: 1421, totalSwabs: 21598},
        {date: new Date('2021-01-31'), positiveSwabs: 1153, totalSwabs: 17649},
        {date: new Date('2021-02-01'), positiveSwabs: 831, totalSwabs: 15047},
        {date: new Date('2021-02-02'), positiveSwabs: 969, totalSwabs: 16329},
        {date: new Date('2021-02-03'), positiveSwabs: 1203, totalSwabs: 18352},
        {date: new Date('2021-02-04'), positiveSwabs: 1283, totalSwabs: 20214},
        {date: new Date('2021-02-05'), positiveSwabs: 1010, totalSwabs: 20278},
        {date: new Date('2021-02-06'), positiveSwabs: 1075, totalSwabs: 19355},
        {date: new Date('2021-02-07'), positiveSwabs: 956, totalSwabs: 15377},
        {date: new Date('2021-02-08'), positiveSwabs: 780, totalSwabs: 12697},
        {date: new Date('2021-02-09'), positiveSwabs: 816, totalSwabs: 15126},
        {date: new Date('2021-02-10'), positiveSwabs: 1096, totalSwabs: 18213},
        {date: new Date('2021-02-11'), positiveSwabs: 861, totalSwabs: 17207},
        {date: new Date('2021-02-12'), positiveSwabs: 986, totalSwabs: 18841},
        {date: new Date('2021-02-13'), positiveSwabs: 1009, totalSwabs: 16414},
        {date: new Date('2021-02-14'), positiveSwabs: 752, totalSwabs: 14400},
        {date: new Date('2021-02-15'), positiveSwabs: 645, totalSwabs: 11452},
        {date: new Date('2021-02-16'), positiveSwabs: 771, totalSwabs: 13119},
        {date: new Date('2021-02-17'), positiveSwabs: 938, totalSwabs: 17104},
        {date: new Date('2021-02-18'), positiveSwabs: 816, totalSwabs: 15499},
        {date: new Date('2021-02-19'), positiveSwabs: 836, totalSwabs: 17036}
      ];

      var graphData = new Array();
      var positiveSwabsTrendLine = {
        "style": "rgba(237, 100, 127, 0.75)",
        "lineStyle": "dotted|solid",
        "width": 2
      };
      var negativeSwabsTrendLine = {
		"style": "rgba(63, 63, 191, 0.75)",
		"lineStyle": "dotted|solid",
		"width": 2
      };
      var positiveSwabs = {
        "label": "Positive Tests",
        "data": [],
        "backgroundColor": "rgba(237, 100, 127, .6)",
        "borderColor": "rgba(233,0,45, 1)",
        "borderWidth": 0,
        "yAxisID": "A",
        "trendlineLinear": positiveSwabsTrendLine
      };
      var negativeSwabs = {
        "label": "Negative Tests",
        "data": [],
        "backgroundColor": "rgba(63, 63, 191, 0.6)",
        "borderColor": "rgba(14, 54, 201, 0.5)",
        "borderWidth": 0,
        "yAxisID": "A",
        "trendlineLinear": negativeSwabsTrendLine
      };
      var percentagePositive = {
          "label": "% Positive",
          "data": [],
          "borderColor": "red",
          "borderWidth": 0,
          "yAxisID": "B",
          "type": "line"
      };
      var chartConfig = {
          "type": "bar",
          "data": {
              labels: [],
              "datasets": [positiveSwabs, negativeSwabs, percentagePositive]
          },
          "options": {
              "scales": {
                  "xAxes": [{
                      "stacked": true
                  }],
                  "yAxes": [{
                      "id": "A",
                      "stacked": true,
                      "position": "left",
                      "ticks": {
                          "beginAtZero": true
                      },
                      "scaleLabel": {
                          "display": true,
                          "labelString": "Total Tests"
                      }
                  }, {
                      "id": "B",
                      "position": "right",
                      "ticks": {
                          "beginAtZero": true
                      },
                      "gridLines": {
                          "display": false
                      },
                      "scaleLabel": {
                          "display": true,
                          "labelString": "% Positive"
                      }
                  }]
              },
              "tooltips": {
              	"mode": 'label',
                	"callbacks": {
                  		"label": function (tooltipItem, data) {
                            var datasetLabel = data.datasets[tooltipItem.datasetIndex].label;
                            var datasetValue = data.datasets[tooltipItem.datasetIndex].data[tooltipItem.index];
                            var total = 0;
                            var percentageChange = 0;
                            var difference = 0;
                            for (var i = 0; i < data.datasets.length; i++) {
                            	if (data.datasets[i].label != '% Positive') {
                                total += Number(data.datasets[i].data[tooltipItem.index]);
                              }
                            	if (data.datasets[i].label === 'Positive Tests' && tooltipItem.index > 0) {
                                var previousValue = Number(data.datasets[i].data[tooltipItem.index - 1]);
                                var currentValue = Number(data.datasets[i].data[tooltipItem.index]);
                                var difference = currentValue - previousValue;
                                percentageChange = ((difference * 100) / previousValue).toFixed(2);
                              }
                            }
                            if (tooltipItem.datasetIndex != data.datasets.length - 1) {
                                return datasetLabel + ": " + datasetValue;
                            } else {
                                total = total.toString().includes('.') ? total.toFixed(2) : total;
                                difference = difference.toString().includes('.') ? difference.toFixed(2) : difference;
                                return ['Total Tests: ' + total, 'Difference: ' + difference, '% Difference: ' + percentageChange + '%', datasetLabel + ": " + datasetValue];
                            }
                        }
                      }
                  }
              }
      };
      var testsVpositivityRate = new Chart(ctx, chartConfig);
      lastTwoMonths();
      populateStartAndEndDates();
      populateTwoMonthView();

      function populateTwoMonthView() {
          var twoMonthViewSelect = document.getElementById('twoMonthView');
          var startTimestamps = new Array();
          data.forEach(function(value, index) {
              var date = new Date(value.date.getTime());
              date.setDate(1);
              date.setHours(12);
              var startTimestamp = date.getTime();
              if (!startTimestamps.includes(startTimestamp)) {
                  startTimestamps.push(startTimestamp);
              }
          });
          for (var counter = 0; counter < (startTimestamps.length - 1); counter++) {
              var startDate = new Date(startTimestamps[counter]);
              var endDate = new Date(startTimestamps[counter + 1]);
              endDate.setMonth(endDate.getMonth() + 1);
              endDate.setDate(0);
              var twoMonthOption = document.createElement('option');
              twoMonthOption.value = startDate.getTime() + '|' + endDate.getTime();
              twoMonthOption.innerHTML = months[startDate.getMonth()] + ' ' + startDate.getFullYear() + ' - ' + months[endDate.getMonth()] + ' ' + endDate.getFullYear();
              if (counter === (startTimestamps.length - 2)) {
                  twoMonthOption.selected = true;
              }
              twoMonthViewSelect.appendChild(twoMonthOption);
          }
      }

      function twoMonthView() {
          disableStartAndEndDates();
          graphData = new Array();
          var twoMonthViewSelect = document.getElementById('twoMonthView');
          twoMonthViewSelect.disabled = false;
          var timeStamps = twoMonthViewSelect.value.split('|');
          var startDate = new Date(Number(timeStamps[0]));
          startDate.setDate(0);
          var endDate = new Date(Number(timeStamps[1]));
          data.forEach(function(item, index) {
              if (item.date >= startDate && item.date <= endDate) {
                  graphData.push(item);
              }
          });
          processGraphData();
      }

      function lastTwoMonths() {
          disableStartAndEndDates();
          graphData = new Array();
          var twoMonthsAgo = new Date();
          twoMonthsAgo.setMonth(twoMonthsAgo.getMonth() - 2);
          data.forEach(function(value, index) {
              if (value.date > twoMonthsAgo) {
                  graphData.push(value)
              }
          });
          processGraphData();
      }

      function allData() {
          disableStartAndEndDates();
          graphData = new Array();
          data.forEach(function(value, index) {
              graphData.push(value);
          });
          processGraphData();
      }

      function disableStartAndEndDates() {
          var selectStartDate = document.getElementById('startDate');
          var selectEndDate = document.getElementById('endDate');
          var startDateLabel = document.getElementById('startDateLabel');
          var endDateLabel = document.getElementById('endDateLabel');
          var twoMonthViewSelect = document.getElementById('twoMonthView');
          twoMonthViewSelect.disabled = true;
          selectStartDate.disabled = true;
          selectEndDate.disabled = true;
          startDateLabel.style.color = '#999999';
          endDateLabel.style.color = '#999999';
      }

      function betweenDates() {
          graphData = new Array();
          disableStartAndEndDates();
          var selectStartDate = document.getElementById('startDate');
          var selectEndDate = document.getElementById('endDate');
          var startDateLabel = document.getElementById('startDateLabel');
          var endDateLabel = document.getElementById('endDateLabel');
          selectStartDate.disabled = false;
          selectEndDate.disabled = false;
          startDateLabel.style.color = 'black';
          endDateLabel.style.color = 'black';
          var startDate = new Date(selectStartDate.value);
          var endDate = new Date(selectEndDate.value);
          data.forEach(function(item, index) {
              if (item.date >= startDate && item.date <= endDate) {
                  graphData.push(item);
              }
          });
          populateStartAndEndDates(startDate, endDate);
          processGraphData();
      }

      function populateStartAndEndDates(startDate, endDate) {
          startDate = startDate ? startDate : data[0].date;
          endDate = endDate ? endDate : data[data.length - 1].date;
          var selectStartDate = document.getElementById('startDate');
          var selectEndDate = document.getElementById('endDate');
          selectStartDate.innerHTML = '';
          selectEndDate.innerHTML = '';
          data.forEach(function(item, index) {
              if (item.date < endDate) {
                  var startOpt = document.createElement('option');
                  startOpt.value = item.date.toISOString();
                  startOpt.innerHTML = item.date.toDateString();
                  if (item.date.getTime() === startDate.getTime()) {
                      startOpt.selected = true;
                  }
                  selectStartDate.appendChild(startOpt);
              }
              if (item.date > startDate) {
                  var endOpt = document.createElement('option');
                  endOpt.value = item.date.toISOString();
                  endOpt.innerHTML = item.date.toDateString();
                  if (item.date.getTime() === endDate.getTime()) {
                      endOpt.selected = true;
                  }
                  selectEndDate.appendChild(endOpt);
              }
          });
      }

      function processGraphData() {
          var graphType = document.getElementsByName("graphType");
          graphType.forEach(function(value, index) {
              if (value.checked) {
                  value.onclick();
              }
          });
      }

      function standardGraph() {
          resetGraph();
          var labels = new Array();
          var positiveSwabs = new Array();
          var negativeSwabs = new Array();
          var percentagePositive = new Array();
          graphData.forEach(function(value, index) {
              labels.push(value.date.toDateString());
              positiveSwabs.push(value.positiveSwabs);
              negativeSwabs.push(value.totalSwabs - value.positiveSwabs);
              percentagePositive.push(((value.positiveSwabs * 100) / value.totalSwabs).toFixed(2));
          });
          updateGraph(labels, positiveSwabs, negativeSwabs, percentagePositive);
      }

      function byDay() {
          resetGraph();
          var day = document.getElementById("day");
          day.disabled = false;
          var labels = new Array();
          var positiveSwabs = new Array();
          var negativeSwabs = new Array();
          var percentagePositive = new Array();
          graphData.forEach(function(value, index) {
              if (value.date.getDay() == day.value) {
                  labels.push(value.date.toDateString());
                  positiveSwabs.push(value.positiveSwabs);
                  negativeSwabs.push(value.totalSwabs - value.positiveSwabs);
                  percentagePositive.push(((value.positiveSwabs * 100) / value.totalSwabs).toFixed(2));
              }
          });
          updateGraph(labels, positiveSwabs, negativeSwabs, percentagePositive);
      }

      function dayAverage(increment, prefix) {
          prefix = prefix ? prefix : '';
          resetGraph();
          var labels = new Array();
          var positiveSwabs = new Array();
          var negativeSwabs = new Array();
          var percentagePositive = new Array();
          var initialIndex = 0;
          var todayDay = new Date().getDay();
          for (var counter = 6; counter < 15; counter++) {
            if (graphData[counter].date.getDay() === todayDay) {
              initialIndex = counter;
              break;
            }
          }
          for (var counter = initialIndex; counter < graphData.length; counter += increment) {
              var today = graphData[counter];
              var yesterday = graphData[counter - 1];
              var twoDaysAgo = graphData[counter - 2];
              var threeDaysAgo = graphData[counter - 3];
              var fourDaysAgo = graphData[counter - 4];
              var fiveDaysAgo = graphData[counter - 5];
              var sixDayAgo = graphData[counter - 6];
              labels.push(prefix + today.date.toDateString());
              var totalPositiveSwabs = today.positiveSwabs + yesterday.positiveSwabs + twoDaysAgo.positiveSwabs + threeDaysAgo.positiveSwabs + fourDaysAgo.positiveSwabs + fiveDaysAgo.positiveSwabs + sixDayAgo.positiveSwabs;
              var totalNegativeSwabs = (today.totalSwabs - today.positiveSwabs) + (yesterday.totalSwabs - yesterday.positiveSwabs) + (twoDaysAgo.totalSwabs - twoDaysAgo.positiveSwabs) + (threeDaysAgo.totalSwabs - threeDaysAgo.positiveSwabs) + (fourDaysAgo.totalSwabs - fourDaysAgo.positiveSwabs) + (fiveDaysAgo.totalSwabs - fiveDaysAgo.positiveSwabs) + (sixDayAgo.totalSwabs - sixDayAgo.positiveSwabs);
              var totalSwabs = (today.totalSwabs + yesterday.totalSwabs + twoDaysAgo.totalSwabs + threeDaysAgo.totalSwabs + fourDaysAgo.totalSwabs + fiveDaysAgo.totalSwabs + sixDayAgo.totalSwabs);
              positiveSwabs.push((totalPositiveSwabs / 7).toFixed(2));
              negativeSwabs.push((totalNegativeSwabs / 7).toFixed(2));
              percentagePositive.push(((totalPositiveSwabs * 100) / totalSwabs).toFixed(2));
          }
          updateGraph(labels, positiveSwabs, negativeSwabs, percentagePositive);
      }

      function weeklyTotal() {
          resetGraph();
          var labels = new Array();
          var positiveSwabs = new Array();
          var negativeSwabs = new Array();
          var percentagePositive = new Array();
          for (var counter = 6; counter < graphData.length; counter++) {
              var today = graphData[counter];
              if (today.date.getDay() === 6) {
                  var yesterday = graphData[counter - 1];
                  var twoDaysAgo = graphData[counter - 2];
                  var threeDaysAgo = graphData[counter - 3];
                  var fourDaysAgo = graphData[counter - 4];
                  var fiveDaysAgo = graphData[counter - 5];
                  var sixDayAgo = graphData[counter - 6];
                  labels.push('Week ending ' + today.date.toDateString());
                  var totalPositiveSwabs = today.positiveSwabs + yesterday.positiveSwabs + twoDaysAgo.positiveSwabs + threeDaysAgo.positiveSwabs + fourDaysAgo.positiveSwabs + fiveDaysAgo.positiveSwabs + sixDayAgo.positiveSwabs;
                  var totalNegativeSwabs = (today.totalSwabs - today.positiveSwabs) + (yesterday.totalSwabs - yesterday.positiveSwabs) + (twoDaysAgo.totalSwabs - twoDaysAgo.positiveSwabs) + (threeDaysAgo.totalSwabs - threeDaysAgo.positiveSwabs) + (fourDaysAgo.totalSwabs - fourDaysAgo.positiveSwabs) + (fiveDaysAgo.totalSwabs - fiveDaysAgo.positiveSwabs) + (sixDayAgo.totalSwabs - sixDayAgo.positiveSwabs);
                  var totalSwabs = (today.totalSwabs + yesterday.totalSwabs + twoDaysAgo.totalSwabs + threeDaysAgo.totalSwabs + fourDaysAgo.totalSwabs + fiveDaysAgo.totalSwabs + sixDayAgo.totalSwabs);
                  positiveSwabs.push(totalPositiveSwabs);
                  negativeSwabs.push(totalNegativeSwabs);
                  percentagePositive.push(((totalPositiveSwabs * 100) / totalSwabs).toFixed(2));
              }
          }
          updateGraph(labels, positiveSwabs, negativeSwabs, percentagePositive);
      }

      function resetGraph() {
          var day = document.getElementById("day");
          day.disabled = true;
          chartConfig.data.labels = new Array();
          positiveSwabs.data = new Array();
          negativeSwabs.data = new Array();
          percentagePositive.data = new Array();
      }

      function updateGraph(labels, positiveSwabsData, negativeSwabsData, percentagePositiveData) {
          csv = ['Date,Total Daily Tests,Positive Daily Tests,Negative Daily Tests,% Positive,Total Tests,Total Positive Tests,Total Negative Tests,% Positive,Change in daily positive tests,Percentage change in daily positive tests'];
          chartConfig.data.labels = labels;
          positiveSwabs.data = positiveSwabsData;
          negativeSwabs.data = negativeSwabsData;
          percentagePositive.data = percentagePositiveData;

          var maxSwabs = 0;
          var maxPercentage = 0;
          for (var counter = 0; counter < positiveSwabsData.length; counter++) {
              var positiveSwabData = positiveSwabsData[counter];
              var negativeSwabData = negativeSwabsData[counter];
              var totalSwabs = Number(positiveSwabData) + Number(negativeSwabData);
              maxSwabs = Math.max(maxSwabs, totalSwabs);
              maxPercentage = Math.max(maxPercentage, Number(percentagePositiveData[counter]));
          }
          maxSwabs = (Math.round(maxSwabs / 5000) * 5000) + 5000;
          maxPercentage = (Math.round(maxPercentage / 5) * 5) + 5;
          var calculatedMaxPercentage = maxSwabs / 1000;
//          chartConfig.options.scales.yAxes[0].ticks.max = maxSwabs;
//          chartConfig.options.scales.yAxes[1].ticks.max = maxPercentage;
          testsVpositivityRate.update();

          // Populate date table
          var oldDataTableBody = document.getElementById('dataTable').getElementsByTagName('tbody')[0];
          var newDataTableBody = document.createElement('tbody');
          var totalTests = 0;
          var totalPositive = 0;
          var totalNegative = 0;
          var previousDaysPositiveTests = 0;
          labels.forEach(function(item, index) {
              var csvData = new Array();
              // Insert date cell
              var newRow = newDataTableBody.insertRow();
              var newCell = newRow.insertCell();
              var newText = document.createTextNode(item);
              var dailyTests = Number(positiveSwabsData[index]) + Number(negativeSwabsData[index]);

              totalTests += dailyTests
              totalPositive += Number(positiveSwabsData[index]);
              totalNegative += Number(negativeSwabsData[index]);
              newCell.appendChild(newText);
              csvData.push(item);

              // Insert daily total tests cell
              createCell(newRow, dailyTests);
              csvData.push(dailyTests);

              // Insert daily positive tests cell
              createCell(newRow, positiveSwabsData[index]);
              csvData.push(positiveSwabsData[index]);

              // Insert daily negative tests cell
              createCell(newRow, negativeSwabsData[index]);
              csvData.push(negativeSwabsData[index]);

              // Insert daily % positive cell
              createCell(newRow, percentagePositiveData[index]);
              csvData.push(percentagePositiveData[index]);

              // Insert cumulative total tests cell
              createCell(newRow, totalTests);
              csvData.push(totalTests);

              // Insert cumulative positive tests cell
              createCell(newRow, totalPositive);
              csvData.push(totalPositive);

              // Insert cumulative negative tests cell
              createCell(newRow, totalNegative);
              csvData.push(totalNegative);

              // Insert total % positive cell
              var percentagePositive = ((totalPositive * 100) / totalTests).toFixed(2);
              createCell(newRow, percentagePositive);
              csvData.push(percentagePositive);

              if (index > 0) {

                  var changeInPositiveTests = positiveSwabsData[index] - previousDaysPositiveTests;
                  var percentageChange = ((changeInPositiveTests * 100) / previousDaysPositiveTests).toFixed(2)
                  createCell(newRow, changeInPositiveTests);
                  csvData.push(changeInPositiveTests);
                  createCell(newRow, percentageChange);
                  csvData.push(percentageChange + '%');

              } else {
                  createCell(newRow, '-');
                  createCell(newRow, '-');
                  csvData.push('-');
                  csvData.push('-');
              }
              previousDaysPositiveTests = positiveSwabsData[index];
              csv.push(csvData.join(','));
          });
          oldDataTableBody.parentNode.replaceChild(newDataTableBody, oldDataTableBody);
      }

      function createCell(tableRow, value) {
          var cell = tableRow.insertCell();
          var newText = document.createTextNode(value.toString().includes('.') ? Number(value).toFixed(2) : value);
          cell.appendChild(newText);
      }

      function displayGraph() {
          var table = document.getElementById('table');
          var graph = document.getElementById('graph');
          table.style.display = 'none';
          graph.style.display = 'block'
      }

      function displayTable() {
          var table = document.getElementById('table');
          var graph = document.getElementById('graph');
          table.style.display = 'block';
          graph.style.display = 'none'
      }

      function exportAsImage() {
        var downloadLink = document.createElement("a");
        downloadLink.download = "swabData.png";
        downloadLink.href = document.getElementById('testsVpositivityRate')
                                    .toDataURL('image/png')
                                    .replace('image/png', 'image/octet-stream');

        downloadLink.click();
      }

      function exportAsCSV() {
        var csvFile = csvFile = new Blob([csv.join('\n')], {type:"text/csv"});
        var downloadLink = document.createElement("a");
        downloadLink.download = "swabData.csv";
        downloadLink.href = window.URL.createObjectURL(csvFile);
        downloadLink.style.display = "none";
        document.body.appendChild(downloadLink);
        downloadLink.click();
      }

      function trendLine() {
		var trendLine = document.getElementById('trendLine');
		if (trendLine.checked) {
		  positiveSwabs.trendlineLinear = positiveSwabsTrendLine;
		  negativeSwabs.trendlineLinear = negativeSwabsTrendLine;
		} else {
		  positiveSwabs.trendlineLinear = null;
		  negativeSwabs.trendlineLinear = null;
		}
		testsVpositivityRate.update();
      }
    </script>
  </body>
</html>
